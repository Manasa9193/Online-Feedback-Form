<!DOCTYPE html>
<html lang="en">
<head>
    <title>Feedback Form 2</title>
    <style>
        body {
            font-family: Arial, sans-serif;
        }
        .container {
            position: relative;
            top: 170px;
            left: -205px;
            max-width: 570px;
            height: 545px; 
            margin: 20px auto;
            padding: 20px;
            border-width: 2px; 
            border-style: solid; 
            border-color: #333; 
            background-color: #FFFFFF;
            border-radius: 5px;
            overflow-y: auto; 
        }
        h1 {
            text-align: center;
            color: #333;
        }
        .question {
            margin-bottom: 35px;
        }
        .question label {
            display: block;
            margin-bottom: 5px;
            color: #333;
        }
        .question input[type="radio"] {
            margin-right: 10px;
            margin-left: 20px;
        }
        .question input[type="text"] {
            width: 450px;
            padding: 8px;
            margin-left: 20px;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-sizing: border-box;
        }
        video {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .next-button {
            background-color: transparent;
            border: none;
            cursor: pointer;
        }
        .message {
            margin-top: 10px;
            color: red; /* Default color for error messages */
        }
    </style>
</head>
<body>
    <video autoplay muted loop>
        <source src="images/Fedback.mp4" type="video/mp4">
        <track src="subtitles_en.vtt" kind="subtitles" srclang="en" label="English">
    </video>
    <div class="container">
    
            <form id="part2-form" action="/submit-part2" method="POST" onsubmit="return validateForm()">
            <!-- Questions and Inputs -->
            <div class="question">
                <label for="punctuality">How timely is the faculty?<span style="color: red;">*</span></label>
                <input type="radio" id="punctuality1" name="punctuality" value="1"> 1
                <input type="radio" id="punctuality2" name="punctuality" value="2"> 2
                <input type="radio" id="punctuality3" name="punctuality" value="3"> 3
                <input type="radio" id="punctuality4" name="punctuality" value="4"> 4
                <input type="radio" id="punctuality5" name="punctuality" value="5"> 5
            </div>
            <div class="question">
                <label for="clarification">Rate the effectiveness of doubt clarification (out of 5)<span style="color: red;">*</span></label>
                <input type="radio" id="clarification1" name="clarification" value="1"> 1
                <input type="radio" id="clarification2" name="clarification" value="2"> 2
                <input type="radio" id="clarification3" name="clarification" value="3"> 3
                <input type="radio" id="clarification4" name="clarification" value="4"> 4
                <input type="radio" id="clarification5" name="clarification" value="5"> 5
            </div>
            <div class="question">
                <label for="explanation">Rating on topics Explanation:<span style="color: red;">*</span></label>
                <input type="radio" id="explanation1" name="explanation" value="1"> 1
                <input type="radio" id="explanation2" name="explanation" value="2"> 2
                <input type="radio" id="explanation3" name="explanation" value="3"> 3
                <input type="radio" id="explanation4" name="explanation" value="4"> 4
                <input type="radio" id="explanation5" name="explanation" value="5"> 5
            </div>
            <div class="question">
                <label for="communication">How interactive are classes in communicating?<span style="color: red;">*</span></label>
                <input type="radio" id="communication1" name="communication" value="1"> 1
                <input type="radio" id="communication2" name="communication" value="2"> 2
                <input type="radio" id="communication3" name="communication" value="3"> 3
                <input type="radio" id="communication4" name="communication" value="4"> 4
                <input type="radio" id="communication5" name="communication" value="5"> 5
            </div>
            <div class="question">
                <label for="feedback">Share your overall thoughts and feelings with us!<span style="color: red;">*</span>:</label>
                <input type="radio" id="feedback1" name="feedback" value="1"> üò°
                <input type="radio" id="feedback2" name="feedback" value="2"> üòï
                <input type="radio" id="feedback3" name="feedback" value="3"> üòê
                <input type="radio" id="feedback4" name="feedback" value="4"> üôÇ
                <input type="radio" id="feedback5" name="feedback" value="5"> üòÑ
            </div>
            <div class="question">
                <label for="other">Any Suggestions</label>
                <input type="text" id="other" name="other">
            </div>
            <div id="message" class="message"></div>
            <button type="button" onclick="window.history.back();" class="next-button">
                <img src="images/image.png" alt="Previous" width="50" height="50">
            </button>
            <button type="submit" class="next-button">
                <img src="images/submit.png" alt="Submit" width="50" height="50">
            </button>
        </form>
    </div>

    <script>
        function validateForm() {
            var feedbackFields = ['punctuality', 'clarification', 'explanation', 'communication', 'feedback'];
            var isValid = true;

            feedbackFields.forEach(function(field) {
                var elements = document.getElementsByName(field);
                var checked = Array.from(elements).some(element => element.checked);
                if (!checked) {
                    alert('Please provide a rating for ' + field + '.');
                    isValid = false;
                }
            });

            return isValid;
        }

        document.addEventListener('DOMContentLoaded', function() {
            var params = new URLSearchParams(window.location.search);
            var feedbackFields = ['punctuality', 'clarification', 'explanation', 'communication', 'feedback', 'other'];
            feedbackFields.forEach(function(field) {
                var value = params.get(field);
                if (value) {
                    var radio = document.querySelector(`input[name="${field}"][value="${value}"]`);
                    if (radio) {
                        radio.checked = true;
                    }
                    var textField = document.getElementById(field);
                    if (textField && textField.type === 'text') {
                        textField.value = value;
                    }
                }
            });
        });

        document.getElementById('feedbackForm').addEventListener('submit', function(event) {
            event.preventDefault(); // Prevent the default form submission

            if (!validateForm()) {
                return; // Stop submission if validation fails
            }

            const form = document.getElementById('feedbackForm');
            const formData = new FormData(form);

            // Debug: log formData entries
            for (let [key, value] of formData.entries()) {
                console.log(key, value);
            }

            fetch('/submit-part2', {
                method: 'POST',
                body: formData
            }).then(response => response.json())
              .then(data => {
                  const messageElement = document.getElementById('message');
                  if (data.success) {
                      messageElement.style.color = 'green';
                      messageElement.textContent = data.message;
                      setTimeout(() => {
                          window.location.href = '/thankyou.html';
                      }, 200); 
                  } else {
                      messageElement.style.color = 'red';
                      messageElement.textContent = data.message;
                  }
              }).catch(error => {
                  console.error('Error:', error);
                  const messageElement = document.getElementById('message');
                  messageElement.style.color = 'red';
                  messageElement.textContent = 'An error occurred while submitting your feedback.';
              });
        });
    </script>
</body>
</html>

